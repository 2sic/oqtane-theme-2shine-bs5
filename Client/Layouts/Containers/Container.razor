@namespace ToSic.Oqt.Themes.ToShineBs5.Client.Layouts
@inherits Oqtane.Themes.ContainerBase
@using System.Text.Json;
@using System.Text.RegularExpressions;

<div id="module-@ModuleState.ModuleId" class="to-shine-background-container py-4 @ModuleType()">
    <div class="container">
        <ModuleActions/>
        <ModuleInstance/>
    </div>
</div>

@code {
    public override string Name => "ToShine container";
    //public override string Name => "Container for Designed Content";

    // Function to check if the module is published and assign the right class to it
    // Todo: Permissions shouldn't be handeld with string manipulation -> there should be a better way
    private string ModulePublishState()
    {
        var modulePermissions = ModuleState.Permissions;

        var moduleViewPermission = Regex.Match(modulePermissions, "{\\\"PermissionName\\\":\\\"View\\\",\\\"Permissions\\\":\\\".*\\\"}");

        var isPublished = moduleViewPermission.ToString().Contains("All Users");

        if (isPublished)
        {
            return "";
        } else
        {
            return "to-shine-unpublished";
        }
    }

    private string ModuleType()
    {
        var moduleTypeString = ModuleState.ModuleType;
        string[] moduleTypes = moduleTypeString.Split(",");
        string[] modules = moduleTypes[0].Split(".");
        if(modules[2] == "Admin")
        {
            return "to-shine-admin-container";
        } else
        {
            return string.Empty;
        }
    }
}