@namespace ToSic.Oqt.Themes.ToShineBs5.Client.Layouts
@inherits Oqtane.Themes.ContainerBase
@using System.Text.RegularExpressions;
@*
    File Purpose:       Container for normal modules.
    Recommendations:    -
    Nice to know:       Will not show a title or anything, so it's really clean
                        Should (WIP) also add a special class to show that the module is not yet published
    TODO:
    - Fix how permissions are determined if not published, ATM looks fishy
    - ModuleType detection also looks fishy
*@
<div id="module-@ModuleState.ModuleId" class="to-shine-background-container py-4 @ModuleType() @ModulePublishStateClasses()">
    <div class="container">
        <ModuleActions/>
        <ModuleInstance/>
    </div>
</div>

@code {
    public override string Name => "Default Container";

    // Function to check if the module is published and assign the right class to it
    // TODO: Permissions shouldn't be handled with string manipulation -> there should be a better way
    private string ModulePublishStateClasses()
    {
        var modulePermissions = ModuleState.Permissions;

        var moduleViewPermission = Regex.Match(modulePermissions, "{\\\"PermissionName\\\":\\\"View\\\",\\\"Permissions\\\":\\\".*\\\"}");

        var isPublished = moduleViewPermission.ToString().Contains("All Users");

        return isPublished ? "" : "to-shine-unpublished";
    }

    private string ModuleType()
    {
        var moduleTypeString = ModuleState.ModuleType;
        var moduleTypes = moduleTypeString.Split(",");
        var modules = moduleTypes[0].Split(".");
        return modules[2] == "Admin" ? "to-shine-admin-container" : string.Empty;
    }
}